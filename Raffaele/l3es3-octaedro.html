<html>
	<head>
		<title>es2 octaedro
        </title>
		<style>
		body {
			font-family: Monospace;
			background-color: #f0f0f0;
			margin: 0px;
			overflow: hidden;
		}
		canvas {
			width: 100%;
			height: 100%;
		}
		</style>
		<script src="lib/three.js"></script>
		<script src="lib/stats.min.js"></script>
	</head>
	<body>

		<script>
			var scene, renderer, camera, stats, octaedro;
			
			function Start() {
			
				scene = new THREE.Scene();
				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
				renderer = new THREE.WebGLRenderer();
				renderer.setSize( window.innerWidth, window.innerHeight );
				renderer.setClearColor(0xf0f0f0);//pulire lo sfondo con un colore scelto
				document.body.appendChild( renderer.domElement );
				
				var geometry = new THREE.OctahedronGeometry(1,0);
				var material = new THREE.MeshBasicMaterial( { color: 0x000000, wireframe: true } );
				Redifine(geometry, 7);
				octaedro = new THREE.Mesh( geometry, material );
				scene.add( octaedro );
				camera.position.z = 5;
				stats = new Stats();
				stats.domElement.style.position = 'absolute';
				stats.domElement.style.top = '0px';
				document.body.appendChild( stats.domElement );
				
			}

			function Redifine(octahedron, number){
				if(number != 0){
                    var a, b, c, newvertex1, newvertex2, newvertex3;
					var inizio = octahedron.vertices.length;
					var nfaces = octahedron.faces.length;
					var vertici = octahedron.vertices;
					for(i=0; i<nfaces; i++){
                        a = octahedron.faces[i].a;
                        b = octahedron.faces[i].b;
                        c = octahedron.faces[i].c;
                        newvertex1 = (new THREE.Vector3(Medium(vertici[a].x, vertici[b].x),
								Medium(vertici[a].y, vertici[b].y),
								Medium(vertici[a].z, vertici[b].z)));
                        newvertex2 = (new THREE.Vector3(Medium(vertici[c].x, vertici[b].x),
								Medium(vertici[c].y, vertici[b].y),
								Medium(vertici[c].z, vertici[b].z)));
                        newvertex3 = (new THREE.Vector3(Medium(vertici[a].x, vertici[c].x),
								Medium(vertici[a].y, vertici[c].y),
								Medium(vertici[a].z, vertici[c].z)));
                        b1 = true;
                        b2 = true;
                        b3 = true;
						for(j=0; j<inizio; j++){
							if(vertici[j].x == newvertex1.x &&
                            vertici[j].y == newvertex1.y &&
                            vertici[j].z == newvertex1.z){
								b1=false;
                                pos1 = j;
							}
                            if(vertici[j].x == newvertex2.x &&
                            vertici[j].y == newvertex2.y &&
                            vertici[j].z == newvertex2.z){
								b2=false;
                                pos2 = j;
							}
                            if(vertici[j].x == newvertex3.x &&
                            vertici[j].y == newvertex3.y &&
                            vertici[j].z == newvertex3.z){
								b3=false;
                                pos3 = j;
							}
						}
                        if(b1){
                            octahedron.vertices.push(newvertex1);
                            pos1 = inizio;
                            inizio++;
                        }
                        if(b2){
                            octahedron.vertices.push(newvertex2);
                            pos2 = inizio;
                            inizio++;
                        }
                        if(b3){
                            octahedron.vertices.push(newvertex3);
                            pos3 = inizio;
                            inizio++;
                        }
                        octahedron.faces[i] = new THREE.Face3(pos1,pos2,pos3);
                        octahedron.faces.push(new THREE.Face3(a,pos1,pos3));
                        octahedron.faces.push(new THREE.Face3(b,pos1,pos2));
                        octahedron.faces.push(new THREE.Face3(c,pos2,pos3));
					}
					var vertici2 = octahedron.vertices;
					var fine = vertici2.length;
					for(i=0; i < fine; i++){
						octahedron.vertices[i].normalize();
					}
					Redifine(octahedron, number - 1);
				}
			}
			function Medium( a, b ){
				return (a + b) / 2;
			}
			
			function Update() {
				octaedro.rotation.y += 0.02;
				requestAnimationFrame(Update);
				stats.update();
				renderer.render(scene, camera);
			}
			
			Start();
			Update();
			
		</script>
	</body>
</html>